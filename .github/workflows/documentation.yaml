name: Deploy Docusaurus Documentation

on:
  push:
    branches:
      - gh-pages-release  # Replace with your target branch

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout code
      - name: Checkout code
        uses: actions/checkout@v4

      # Step 2: Create Docusaurus directory structure
      - name: Prepare Docusaurus Directory
        run: |
          mkdir -p docusaurus-site/docs
          mkdir -p docusaurus-site/src/css

      # Step 3: Create minimal Docusaurus configuration files
      - name: Create Docusaurus Configuration
        working-directory: docusaurus-site
        run: |
          # Create config file
          cat > docusaurus.config.js << EOL
          const lightCodeTheme = require('prism-react-renderer/themes/github');
          const darkCodeTheme = require('prism-react-renderer/themes/dracula');

          module.exports = {
            title: 'Snapper',
            tagline: 'Snapper',
            url: 'https://asifqatar.github.io/Snapper',
            baseUrl: '/Snapper/',
            trailingSlash: false,
            onBrokenLinks: 'throw',
            onBrokenMarkdownLinks: 'warn',
            favicon: 'https://avatars.githubusercontent.com/u/105142204?s=48&v=4',
            organizationName: 'asifqatar',
            projectName: 'Snapper',
            presets: [
              [
                '@docusaurus/preset-classic',
                {
                  docs: {
                    sidebarPath: require.resolve('./sidebars.js'),
                    routeBasePath: '/', // Opens Docs as the homepage
                    editUrl: 'https://github.com/sayfer-io/Snapper/blob/main/',
                  },
                  blog: {
                    showReadingTime: true,
                    editUrl:
                      'https://github.com/facebook/docusaurus/edit/main/website/blog/',
                  },
                  theme: {
                    customCss: require.resolve('./src/css/custom.css'),
                  },
                },
              ],
            ],
            themeConfig: {
              navbar: {
                title: 'Snapper',
                logo: {
                  alt: 'Snapper',
                  src: 'https://avatars.githubusercontent.com/u/105142204?s=200&v=4',
                },
                items: [
                  {
                    type: 'doc',
                    docId: 'intro',
                    position: 'left',
                    label: 'Docs',
                  },
                ],
              },
              footer: {
                style: 'dark',
                links: [
                  {
                    title: 'Docs',
                    items: [
                      {
                        label: 'API',
                        to: '#',
                      },
                    ],
                  },
                  {
                    title: 'Community',
                    items: [
                      {
                        label: 'Stack Overflow',
                        href: 'https://stackoverflow.com/questions/tagged/',
                      },
                      {
                        label: 'Discord',
                        href: 'https://discordapp.com/invite',
                      },
                      {
                        label: 'Twitter',
                        href: 'https://twitter.com',
                      },
                    ],
                  },
                  {
                    title: 'More',
                    items: [
                      {
                        label: 'Blog',
                        to: 'https://sayfer.io/blog',
                      },
                      {
                        label: 'GitHub',
                        href: 'https://github.com/sayfer-io/Snapper',
                      },
                    ],
                  },
                ],
                copyright: \`Copyright Â© \${new Date().getFullYear()} Snapper, Inc.\`,
              },
              prism: {
                theme: lightCodeTheme,
                darkTheme: darkCodeTheme,
              },
            },
          };
          EOL

          # Create minimal sidebars file
          cat > sidebars.js << EOL
          module.exports = {
            mySidebar: [
              {
                type: 'doc',
                id: 'intro',
              },
            ],
          };
          EOL

          # Create a basic custom CSS file
          echo "/* Custom CSS */" > src/css/custom.css

          # Create a basic intro doc
          echo "# Introduction to the Project" > docs/intro.md

      # Step 4: Set up Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'  # Use the correct node version
          cache: npm

      # Step 5: Install Docusaurus dependencies
      - name: Install Docusaurus Dependencies
        working-directory: docusaurus-site
        run: |
          npm init -y
          npm install @docusaurus/core @docusaurus/preset-classic @docusaurus/theme-classic

      # Step 6: Build Docusaurus Site
      - name: Build Docusaurus Documentation
        working-directory: docusaurus-site
        run: npx docusaurus build

      # Step 7: Deploy to GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GH_TOKEN }}
          publish_dir: docusaurus-site/build
          publish_branch: gh-pages
